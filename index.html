<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>日日記 | Nichi-Nichi Log</title>

    <meta name="description"
        content="日日記 (Nichi-Nichi Log) 是一款專為旅居日本與頻繁旅日者設計的雙幣記帳 App。支援日幣/台幣原始幣別紀錄、時區自動追蹤、離線 PWA 使用與資料完整匯出。極簡風格，讓您的海外生活記帳更加精準輕鬆。">
    <meta name="keywords" content="記帳, 雙幣記帳, 日本旅遊, 旅居日本, 留學, 打工度假, 分帳, PWA, 離線記帳, 日幣, 台幣, 匯率, Nichi-Nichi">
    <meta name="google-site-verification" content="RSCsK8X-OoCTr2uKZ2oKz-QbY1SjZWYLZRIfQz9NKWY" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://nichi-nichi.app/">
    <meta property="og:title" content="日日記 | Nichi-Nichi Log - 旅日專用雙幣記帳工具">
    <meta property="og:description" content="專為旅居日本設計的極簡記帳 App。支援雙幣別原始金額紀錄、自動時區追蹤、離線 PWA 操作。資料完全掌握在自己手中。">
    <meta property="og:image"
        content="https://raw.githubusercontent.com/keicha2025/nichi-nichi/refs/heads/main/OGImage.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://nichi-nichi.app/">
    <meta property="twitter:title" content="日日記 | Nichi-Nichi Log - 旅日專用雙幣記帳工具">
    <meta property="twitter:description" content="專為旅居日本設計的極簡記帳 App。支援雙幣別原始金額紀錄、自動時區追蹤、離線 PWA 操作。資料完全掌握在自己手中。">
    <meta property="twitter:image"
        content="https://raw.githubusercontent.com/keicha2025/nichi-nichi/refs/heads/main/OGImage.png">

    <!-- JSON-LD Structured Data for Rich Results -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "SoftwareApplication",
          "name": "日日記 (Nichi-Nichi Log)",
          "alternateName": "Nichi-Nichi",
          "applicationCategory": "FinanceApplication",
          "operatingSystem": "Web, iOS, Android",
          "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "TWD"
          },
          "description": "專為旅居日本、頻繁旅日者設計的雙幣記帳 App。提供原始幣別紀錄、時區追蹤、PWA 離線使用與資料主權匯出功能。",
          "featureList": "雙幣紀錄, 時區追蹤, PWA 離線使用, 資料備份與匯出, 分帳管理"
        },
        {
          "@type": "FAQPage",
          "mainEntity": [
            {
              "@type": "Question",
              "name": "如何一次刪除多筆紀錄？",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "前往「紀錄 (History)」頁面，長按任何一筆紀錄即可進入多選模式。選取您想要移除的項目後，點擊底部的紅色垃圾桶按鈕即可批量刪除。"
              }
            },
            {
              "@type": "Question",
              "name": "我可以更改匯率設定嗎？",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "可以。請前往「設定」頁面並找到「匯率」區塊進行更新。您也可以隨時點擊 App 頂部的按鈕切換檢視幣別（日幣/台幣）。"
              }
            },
            {
              "@type": "Question",
              "name": "這款 App 支援離線使用嗎？",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "支援。日日記採用 Web × App 二合一 (PWA) 技術，無需下載即可在瀏覽器使用，也可加入主畫面。支援離線記帳，當您在無網路環境（如地下鐵）時，紀錄會先存於本機，待連網後自動背景同步。"
              }
            }
          ]
        }
      ]
    }
    </script>

    <!-- PWA 核心設定 -->
    <link rel="manifest" href="manifest.json" crossorigin="use-credentials">
    <meta name="theme-color" content="var(--action-primary-bg)">

    <!-- iOS 專屬優化 -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="日日記">
    <link rel="apple-touch-icon" href="./appicon.png">

    <!-- 外部資源 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        txt: {
                            primary: 'var(--txt-primary)',
                            secondary: 'var(--txt-secondary)',
                            muted: 'var(--txt-secondary)',
                            onbrand: 'var(--action-primary-text)'
                        },
                        bg: {
                            main: 'var(--bg-main)',
                            canvas: 'var(--bg-canvas)',
                            subtle: 'var(--bg-subtle)',
                            default: 'var(--bg-main)'
                        },
                        bdr: {
                            default: 'var(--color-border)',
                            subtle: 'var(--shadow-color)',
                            outline: 'var(--color-outline)'
                        },
                        action: {
                            primary: {
                                bg: 'var(--action-primary-bg)',
                                hover: 'var(--action-primary-hover)',
                                text: 'var(--action-primary-text)'
                            }
                        },
                        chart: {
                            1: 'var(--chart-color-1)',
                            2: 'var(--chart-color-2)',
                            3: 'var(--chart-color-3)',
                            4: 'var(--chart-color-4)',
                            5: 'var(--chart-color-5)',
                            6: 'var(--chart-color-6)',
                            7: 'var(--chart-color-7)',
                            8: 'var(--chart-color-8)'
                        },
                        danger: 'var(--color-danger)',
                        success: 'var(--color-success)',
                        warning: 'var(--color-warning)',
                        info: 'var(--color-info)'
                    }
                }
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500&family=Noto+Sans+JP:wght@300;400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="style.css">
    <style>
        @keyframes spring-up {
            0% {
                transform: translateY(20px) scale(0.9);
                opacity: 0;
            }

            60% {
                transform: translateY(-5px) scale(1.03);
                opacity: 1;
            }

            100% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .animate-spring-up {
            animation: spring-up 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        [v-cloak] {
            display: none;
        }
    </style>
    <link rel="icon" href="appicon.ico" type="image/x-icon">
</head>

<body>
    <div id="app" class="max-w-md mx-auto min-h-screen relative" v-cloak>
        <div v-if="loading" class="fixed inset-0 z-[100] loading-overlay flex flex-col items-center justify-center">
            <div class="w-8 h-8 border-2 border-bdr-subtle border-t-txt-primary rounded-full animate-spin mb-4"></div>
            <p class="text-[10px] tracking-[0.2em] text-txt-secondary uppercase font-light">Syncing...</p>
        </div>

        <app-header :app-mode="appMode" :sync-status="syncStatus" :current-tab="currentTab"
            :history-filter="historyFilter" :show-currency-switcher="true" @retry-sync="retrySync"
            @clear-filter="historyFilter = { mode: 'all', categoryId: null, friendName: null, currency: null }">
        </app-header>

        <main class="w-full px-4 pt-4 pb-32">
            <!-- Viewer Dashboard -->
            <view-dashboard v-if="currentTab === 'overview' && appMode === 'VIEWER'" :transactions="transactions"
                :stats="stats" :friends="friends" :projects="projects" :config="systemConfig"
                :has-multiple-currencies="hasMultipleCurrencies" @switch-tab="handleTabChange"></view-dashboard>

            <!-- Regular Admin/Guest Dashboard -->
            <overview-page v-else-if="currentTab === 'overview'" :transactions="transactions" :stats="stats"
                :fx-rate="fxRate"
                @go-to-history="historyFilter = { mode: $event.mode, categoryId: null, friendName: null, currency: $event.currency }; handleTabChange('history')"></overview-page>

            <history-page v-if="currentTab === 'history'" :transactions="filteredTransactions" :categories="categories"
                :payment-methods="paymentMethods" :projects="projects" :fx-rate="fxRate" @edit-item="handleEditItem"
                @update-filter="Object.assign(historyFilter, $event)"
                @delete-multiple="handleDeleteMultiple"></history-page>

            <add-page v-if="currentTab === 'add'" :form="form" :categories="categories"
                :payment-methods="paymentMethods" :friends="friends" :projects="projects" :loading="loading"
                @toggle-currency="toggleCurrency" @submit="handleSubmit(form)"
                @add-friend-to-list="handleAddFriendToList" @create-project="handleCreateProject"></add-page>
            <edit-page v-if="currentTab === 'edit'" :form="editForm" :categories="categories"
                :payment-methods="paymentMethods" :friends="friends" :projects="projects" :loading="loading"
                @submit="handleSubmit(editForm)" @delete-item="handleDelete"
                @cancel="currentTab = 'history'; editForm = null;" @create-project="handleCreateProject"
                @add-friend-to-list="handleAddFriendToList"></edit-page>
            <stats-page v-if="currentTab === 'stats'" :transactions="transactions" :categories="categories"
                :payment-methods="paymentMethods" :fx-rate="fxRate" :projects="projects"
                @drill-down="handleDrillDown"></stats-page>
            <settings-page v-if="currentTab === 'settings'" :config="systemConfig" :friends="friends"
                :transactions="transactions" :projects="projects" :app-mode="appMode" :current-user="currentUser"
                :categories="categories" :payment-methods="paymentMethods" @update-config="handleUpdateConfig"
                @update-user-data="handleUpdateUserData" @login="handleGoogleLogin" @logout="handleLogout"
                @clear-guest-data="clearGuestData" @view-friend="handleViewFriend" @view-project="handleViewProject"
                @create-project="handleCreateProject" @open-icon-edit="handleOpenIconEdit"
                @clear-account-data="handleClearAccountData" @view-import="currentTab = 'import'"
                @delete-account="handleDeleteAccount" @update:dirty="isSettingsDirty = $event"
                @manage-shared-links="currentTab = 'shared-links'"></settings-page>

            <!-- Icon Edit Page -->
            <icon-edit-page v-if="currentTab === 'icon-edit'" :context="iconEditContext" @select="handleSelectIcon"
                @cancel="currentTab = 'settings'"></icon-edit-page>

            <!-- Project Detail Page -->
            <project-detail-page v-if="currentTab === 'project-detail'" :project="selectedProject"
                :transactions="transactions" :fx-rate="fxRate" @back="currentTab = 'settings'; selectedProject = null"
                @update-project="handleUpdateProject" @view-history="handleViewHistory"></project-detail-page>

            <!-- Import Page -->
            <import-page v-if="currentTab === 'import'" @back="currentTab = 'settings'"
                @refresh-data="retrySync"></import-page>

            <!-- Shared Links Pages -->
            <shared-links-page v-if="currentTab === 'shared-links'" :current-user="currentUser"
                @back="currentTab = 'settings'"
                @create-link="() => { editingLink = null; currentTab = 'edit-shared-links'; }"
                @edit-link="(link) => { editingLink = link; currentTab = 'edit-shared-links'; }"></shared-links-page>

            <edit-shared-links-page v-if="currentTab === 'edit-shared-links'" :link-data="editingLink"
                :projects="projects" :default-user-name="systemConfig.user_name" :current-user="currentUser"
                @back="currentTab = 'shared-links'" @saved="currentTab = 'shared-links'"
                @deleted="currentTab = 'shared-links'"></edit-shared-links-page>
        </main>

        <app-footer :current-tab="currentTab" @update:current-tab="handleTabChange" :app-mode="appMode">
        </app-footer>


        <!-- Success Modal -->
        <!-- System Modal -->
        <system-modal :visible="modalState.visible" :config="modalState.config" @confirm="handleModalConfirm"
            @cancel="handleModalCancel">
        </system-modal>
    </div>

    <!-- 註冊 Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js');
        }
    </script>

    <script type="module" src="./js/app.js?v=1.4"></script>
</body>

</html>